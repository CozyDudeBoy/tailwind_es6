<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>es6문법_02_promise객체.html</title>
  <style>
    #test{background-color: #ff0;}
  </style>
</head>
<body>
  <h2>es6문법_02_promise객체.html</h2>

  <p>promise객체 - 비동기 작업의 "결과를 약속"하는 객체입니다</p>
  <ul>
    <li>promise는 producing code(생성코드)와 Consuming code(소비코드)를 연결하는 
      javascript객체이다
    </li>
    <li>
      producing code(생성코드)는 시간이 걸릴 수 있는 코드
    </li>
    <li>Consuming code(소비코드)는 결과를 기다려야 하는 코드
    </li>
    <li>promise는 producing code(생성코드)와 Consuming code(소비코드)에 대한 호출이 모두 포함된다</li>
    <li>es6문법에서 추가된 객체이다</li>
    <li>실행결과에 대한 '상태정보'를 담고 있으며, 작업의 결과가 promise객체에 저장되고, promise객체를 통해 작업이 '성공'되었는지 '실패'되었는지를 알 수 있다</li>
  </ul>
  <h3>promise문법</h3>
  <pre>
    let 인스턴스 변수명 = new Promise(function(testResolve, testReject)){
      //producing code 작성하기
      testResolve();//성공을 한 경우 실행
      testReject(); // 에러가 발생한 경우 실행
    }

    //Consuming code 작성
    인스턴스 변수명.then(
      function(value){/*성공을 한 경우 코드*/}
      function(error){/*에러가 있을때 코드*/}
    )
  </pre>

  <h3>promise객체 속성</h3>
  <ul>
    <li>promise객체는 크게 '보류중', '실행', '거부' 이렇게 사용할 수 있다</li>
    <li>state 또는 result 라는 속성을 통해 위 명령을 줄 수 있다</li>
    <li>'보류중'인 동안에는 결과가 정의되지 않는다.</li>
    <li>'실행'되면 결과값이 출력된다</li>
    <li>'거부'되면 결과는 오류 객체로 처리 된다</li>
  </ul>
  
  <h3>promise객체 메서드 - then, catch, finally</h3>
  <ul>
    <li>then - Promise객체가 fulfilled상태가 되면 실행할 콜백함수를 등록하는 메서드</li>
    <li>promise객체가 rejected상태가 되면 실행할 콜백 함수를 등록하는 메서드</li>
    <li>finally - 어떤 작업의 성공이나, 실패 여부와 상관없이 '항상 실행하고 싶은 콜백함수'를 등록하는 메서드</li>
  </ul>
    
  <h3>promise 객체를 사용하는 이유</h3>
  <ul>
    <li>비동기 작업을 순차적으로 처리하기 위함</li>
    <li>promise는 구조가 간단해 반환값을 찾아 사용하기 쉽습니다</li>
    <li>callback 함수가 많아지면 코드의 가독성이 나빠지는데 이것을 보완하기 위함</li>
  </ul>

  <h3>실습1. promise객체 사용하기</h3>
  <div id="test"></div>
  <script>
    //1. 변수 선언
    const test = document.getElementById('test');

    //2. 출력을 위한 함수
    function output(x){
      test.innerHTML=x;
    }

    //3. 값을 담아 함수 호출하기
    let txt = '<strong>안녕하세요</strong>';

    // 4. 함수 호출하면서 값 출력하기
    output(txt);

    //promise객체 생성하기
    let testPromise = new Promise(function(testResolve, testReject){
      let num = prompt('양수를 입력하세요.','정수를 입력해주세요');

      if(num>0){
        testResolve('양수를 입력하셨습니다.');
      }else{
        testResolve('숫자를 잘못입력하셨습니다. 다시 확인하고 입력해주세요');
      }
    });

    //실행하기
    //then 메서드 : promise객체가 fulfilled 상태가 되면 실행할 콜백 함수를 등록하는 메서드 입니다.
    testPromise.then(
      function(value){
        output(value);
      },function(error){
        output(error);
      }
    )

  </script>

  <h3>실습2. setTimeOut을 이용한 비동기 처리하기 예제에서 promise객체 사용하기</h3>
  <p>일반함수 값 : <span id="test01"></span></p>
  <p>setTimeout 값 : <span id="test02"></span></p>

  <script>
    //setTimeout(test, 3000); //맞는거
    //setTimeout(test(), 3000);//틀린거 => 함수명 호출시 ()괄호 쓰면 안됨.

    //1. 변수 선언
    const t1 = document.getElementById('test01');
    const t2 = document.getElementById('test02');

    //2. 일반함수로 내용 출력하기
    function outPut01(){
      t1.innerHTML='<span style="color:#f00">저는 일반 함수입니다.</span>';
    }
    
    //3. 함수호출하여 내용 출력하기
    outPut01();
    
    // 비동기 promise로 내용 출력하기
    const outPut02 = new Promise(function(testResolve,testReject){
      setTimeout(function(){
        testResolve('저는 setTimeOut에서 실행되었습니다.');
      },500);
    });
    
    //3. 함수호출하여 내용 출력하기
    outPut01();
    //promise함수
    outPut02.then(function(value){
      t2.innerHTML=value;
    });

    //실습3. 
    function starbucks(coffeename){
      const p = new Promise((resolve, reject)=>{
        if(coffeename==='아메리카노'){ //조건이 맞으면 성공
          resolve("아메리카노 한잔입니다"); //내용 출력
        }else{//값이 일치하지 않으면
          reject("해당메뉴는 없습니다"); //내용출력
        }
      }); //resolve(성공), reject(실패)
      return p;
    };

    //출력내용
    starbucks('아메리카노')// 아메리카노 -> then + finally // 카페라떼 => catch + finally
    .then((resolve) => console.log(resolve))
    .catch((reject) => console.log(reject))
    .finally(() => console.log('감사합니다'));

    

  </script>
</body>
</html>